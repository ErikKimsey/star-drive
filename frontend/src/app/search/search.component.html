<app-loading *ngIf="loading"></app-loading>
<mat-sidenav-container
  [id]="'sidenavContainer'"
  class="mat-typography"
  [hasBackdrop]="false"
>
  <mat-sidenav
    #sidenav
    class="sidenav filters"
  >
    <h2>
      <span>
        <mat-icon>filter_list</mat-icon>
        Filter Resources By:
      </span>
      <div class="spacer"></div>
      <button
        mat-icon-button
        (click)="sideNav.close()"
      >
        <mat-icon>close</mat-icon>
      </button>
    </h2>
    <div class="spacer"></div>
    <mat-accordion>
      <mat-expansion-panel
        *ngFor="let facet of query.facets"
        [ngClass]="{'filter-facet': true}"
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{facet.field}}
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-list>
          <mat-list-item
            *ngFor="let count of facet.facetCounts"
            (click)="addFilter(facet.field, count.category)"
            [ngClass]="{'filter-facet-item': true}"
          >
            {{count.category}}
            <div fxFlex></div>
            <span class="hit-count">{{count.hit_count}}</span>
          </mat-list-item>
        </mat-list>
      </mat-expansion-panel>
    </mat-accordion>
  </mat-sidenav>
  <mat-sidenav-content>
    <div
      class="container"
      fxLayout="column"
      fxLayoutAlign="start center"
    >
      <div class="row search-tools">
        <ul class="applied-filters">
          <li *ngIf="sideNav.opened">
            <button
              mat-button
              (click)="sideNav.close()"
            >
              <i class="icofont-hand-left icofont-2x"></i>
              Select a filter
            </button>
          </li>
          <li *ngIf="!sideNav.opened">
            <button
              mat-button
              (click)="sideNav.open()"
            >
              <mat-icon>filter_list</mat-icon>
              Add a filter
            </button>
          </li>
          <li
            *ngIf="query.words"
            class="applied-filter"
          >
            <button
              mat-button
              (click)="removeWords()"
            >
              <mat-icon>remove_circle_outline</mat-icon>
              Search: {{query.words}}
            </button>
          </li>

          <ng-container *ngFor="let filter of query.filters">
            <li
              *ngFor="let fieldValue of filter.value"
              class="applied-filter"
            >
              <button
                mat-button
                (click)="removeFilter(filter.field, fieldValue)"
              >
                <mat-icon>remove_circle_outline</mat-icon>
                {{filter.field}} : {{fieldValue}}
              </button>
            </li>
          </ng-container>
        </ul>
        <div class="sort-order">
          <mat-form-field>
            <mat-label>
              Sort Results By:
            </mat-label>
            <mat-select value="{{selectedSort.name}}">
              <mat-option
                *ngFor="let s of sortMethods"
                (click)="sortBy(s)"
                value="{{s.name}}"
              >{{s.label}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div
        class="row search-results"
        style="margin-top: 0"
      >
        <div
          id="results"
          fxLayout="column"
          fxLayoutGap="40px"
          *ngIf="!(loading || hideResults)"
        >
          <app-search-result
            *ngFor="let hit of query.hits"
            [hit]="hit"
          >
          </app-search-result>
          <mat-paginator
            [length]="query.total"
            [pageSize]="pageSize"
            [pageSizeOptions]="[pageSize, pageSize*3, pageSize*5]"
            (page)="updatePage()"
          >
          </mat-paginator>
        </div>
      </div>

    </div>
  </mat-sidenav-content>
</mat-sidenav-container>