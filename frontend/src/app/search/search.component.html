<mat-sidenav-container
  [id]="'sidenavContainer'"
  class="mat-typography"
  [hasBackdrop]="false"
>
  <mat-sidenav
    #sidenav
    class="sidenav"
  >
    <h2>
      <span>
        <mat-icon>filter_list</mat-icon>
        Filters
      </span>
      <div class="spacer"></div>
      <button
        mat-icon-button
        (click)="sideNav.close()"
      >
        <mat-icon>close</mat-icon>
      </button>
    </h2>
    <div class="spacer"></div>
    <mat-accordion>
      <mat-expansion-panel *ngFor="let facet of query.facets">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{facet.field}}
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-list>
          <mat-list-item
            *ngFor="let count of facet.facetCounts"
            (click)="addFilter(facet.field, count.category)"
            [ngClass]="{'filter-facet': true}"
          >
            {{count.category}}
            <div fxFlex></div>
            <span class="hit-count">{{count.hit_count}}</span>
          </mat-list-item>
        </mat-list>
      </mat-expansion-panel>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            Sort Results
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-list>
          <mat-list-item (click)="sortByRelevance()" class="sort-order">
            Search Relevance
            <div class="spacer"></div>
          </mat-list-item>
          <mat-list-item (click)="sortByDate()" class="sort-order">
            Recently Updated
            <div class="spacer"></div>
          </mat-list-item>
        </mat-list>
      </mat-expansion-panel>

    </mat-accordion>
  </mat-sidenav>
  <mat-sidenav-content>
    <div class="container">
      <div class="row">
        <ul class="applied-filters">
          <li *ngIf="sideNav.opened">
            <button
              mat-button
              (click)="sideNav.close()"
            >
              <mat-icon>arrow_back</mat-icon>
              Select a filter
            </button>
          </li>
          <li *ngIf="!sideNav.opened">
            <button
              mat-button
              (click)="sideNav.open()"
            >
              <mat-icon>filter_list</mat-icon>
              Add a filter
            </button>
          </li>
          <li *ngIf="query.words">
            <button
              mat-button
              (click)="removeWords()"
            >
              <mat-icon>remove_circle_outline</mat-icon>
              Search: {{query.words}}
            </button>
          </li>

          <ng-container *ngFor="let filter of query.filters">
            <li *ngFor="let fieldValue of filter.value">
              <button
                mat-button
                (click)="removeFilter(filter.field, fieldValue)"
              >
                <mat-icon>remove_circle_outline</mat-icon>
                {{filter.field}} : {{fieldValue}}
              </button>
            </li>
          </ng-container>
        </ul>

        <div
          id="results"
          fxLayout="column"
          fxLayoutGap="40px"
          *ngIf="!(loading || hideResults)"
        >
          <app-search-result
            *ngFor="let hit of query.hits"
            [hit]="hit"
          >
          </app-search-result>
          <mat-paginator
            [length]="query.total"
            [pageSize]="pageSize"
            [pageSizeOptions]="[pageSize, pageSize*3, pageSize*5]"
            (page)="updatePage()"
          >
          </mat-paginator>
        </div>

      </div>

    </div>
  </mat-sidenav-content>
</mat-sidenav-container>