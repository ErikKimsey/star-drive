<div
  id="hero"
  class="gradient-overlay container with-escaping-tiles"
>
  <div class="hero-content">
    <h1>Find Autism Support</h1>
  </div>
  <div
    class="row escaping-tiles"
    fxLayout.lt-sm="column"
    fxLayout.gt-xs="row wrap"
    fxLayoutGap="40px"
    fxLayoutAlign="center auto"
  >
    <div
      *ngFor="let resourceType of resourceTypes"
      class="border-box-tile {{resourceType.name.toLowerCase()}}"
      fxFlex.gt-sm="calc(33% - 160px)"
      fxFlex.sm="calc(50% - 120px)"
    >
      <div
        ngClass="border-box-tile-inner {{isSelectedResourceType(resourceType) ? 'selected' : 'deselected'}}"
        (click)="selectResourceType(resourceType.label)"
      >
        <app-type-icon
          [iconType]="resourceType.name"
          [size]="2"
        ></app-type-icon>
        <div class="border-box-tile-label">{{resourceType.label}}</div>
        <app-details-link url="/search" label=""></app-details-link>
      </div>
    </div>
  </div>
</div>
<div class="container">
  <div
    class="row"
    style="width: 100%"
  >
    <app-resource-add-button [currentUser]="currentUser"></app-resource-add-button>
    <agm-map
      *ngIf="!loading"
      [latitude]="mapLoc ? mapLoc.lat : defaultLoc.lat"
      [longitude]="mapLoc ? mapLoc.lng : defaultLoc.lng"
      [streetViewControl]="false"
      mapTypeId="roadmap"
      [zoom]="7"
      (mapReady)="mapLoad($event)"
    >
      <agm-marker
        *ngIf="mapLoc"
        [latitude]="mapLoc.lat"
        [longitude]="mapLoc.lng"
        iconUrl="/assets/map/your-location.svg"
      ></agm-marker>

      <ng-container *ngIf="locQuery && locQuery.hits">
        <agm-marker-cluster imagePath="/assets/map/m">
          <ng-container *ngFor="let hit of locQuery.hits">
            <agm-marker
              *ngIf="hit.hasCoords()"
              [latitude]="hit.latitude"
              [longitude]="hit.longitude"
            >
              <agm-info-window>
                <h4>{{hit.title}}</h4>
                <p>{{hit.description}}</p>
                <a
                  class="chevron-link"
                  [routerLink]="['/' + hit.type.toLowerCase() + '/' + hit.id]"
                  routerLinkActive="router-link-active"
                >{{hit.type}} Details - {{hit.milesFrom(mapLoc)}}mi</a>
              </agm-info-window>
            </agm-marker>
          </ng-container>
        </agm-marker-cluster>
      </ng-container>
    </agm-map>
    <app-loading *ngIf="loading"></app-loading>
  </div>
</div>

<div class="container" fxLayout="row" fxLayoutGap="80px" fxLayoutAlign="space-evenly start">

  <div fxFlex="calc(30% - 160px)" class="filters">
    <h2>Sort by</h2>
    <mat-radio-group [(ngModel)]="selectedSort.name">
      <mat-radio-button
        *ngFor="let s of sortMethods"
        (click)="sortBy(s)"

        [value]="s.name"
      >{{s.label}}</mat-radio-button>
    </mat-radio-group>
    <h2>Narrow your results</h2>
    <div class="spacer"></div>
    <div *ngIf="!loading">
      <ng-container *ngFor="let facet of query.facets">
        <div *ngIf="facet.field !== 'Type' && facet.facetCounts.length > 0">
          <h3 mat-subheader>{{facet.field}}</h3>
          <mat-list>
            <mat-list-item
              *ngFor="let count of facet.facetCounts"
              (click)="addFilter(facet.field, count.category)"
              [ngClass]="{'filter-facet-item': true}"
            >
              {{count.category}}
              <div fxFlex></div>
              <span class="hit-count">{{count.hit_count}}</span>
            </mat-list-item>
          </mat-list>
        </div>
      </ng-container>
    </div>
  </div>

  <div
    fxFlex="calc(70% - 160px)"
    fxLayout="column"
    fxLayoutAlign="start start"
    *ngIf="!loading"
  >
    <div class="row search-tools">
      <mat-chip-list class="applied-filters">
        <ng-container *ngIf="query.words">
          <mat-chip
            (click)="removeWords()"
            class="applied-filter"
          >
            "{{query.words}}"
            <mat-icon>close</mat-icon>
          </mat-chip>
        </ng-container>

        <ng-container *ngFor="let filter of query.filters">
          <ng-container *ngIf="filter.field !== 'Type'">
            <ng-container *ngFor="let fieldValue of filter.value">
              <mat-chip (click)="removeFilter(filter.field, fieldValue)">
                {{fieldValue}}
                <mat-icon>close</mat-icon>
              </mat-chip>
            </ng-container>
          </ng-container>
        </ng-container>
      </mat-chip-list>
    </div>
    <div
      class="row search-results"
      style="margin-top: 0"
    >
      <div
        id="results"
        fxLayout="column"
        fxLayoutGap="40px"
        *ngIf="!(loading || hideResults)"
      >
        <app-search-result
          *ngFor="let hit of query.hits"
          [hit]="hit"
          [mapLoc]="mapLoc"
        >
        </app-search-result>
        <mat-paginator
            #paginator
            [length]="query.total"
            [pageSize]="pageSize"
            [pageSizeOptions]="[pageSize, pageSize*3, pageSize*5]"
            (page)="updatePage()"
        >
        </mat-paginator>
      </div>
    </div>
  </div>
</div>
<div class="container">
  <div class="row">
    <h1>Resource partners</h1>
    <p>We are partnering with the following initiatives and organizations to identify resources that will improve
      outcomes for individuals with autism and their families.</p>
    <a
      *ngFor="let rg of resourceGatherers"
      [href]="rg.url">
      <img
        [alt]="rg.name"
        [src]="rg.image"
      >
    </a>
  </div>
</div>

